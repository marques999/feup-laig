<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='CGFinterface-method-constructor'><span id='CGFinterface'>/**
</span></span> * CGFinterface
 * @constructor
 */
function CGFinterface() {
	this.mouse = vec2.create();
	this.prevMouse = vec2.create();
	this.mouseButtons = [false, false, false];
	this.activeCamera = null;
	this.ctrlKey = false;
};

<span id='CGFinterface-method-init'>/**
</span> * @method init
 * Initializes the interface, including getting a reference to the scene.
 * @param {CGFapplication} application
 */
CGFinterface.prototype.init = function(application) {
	console.log(&quot;Initializing Interface&quot;);

	this.scene=application.scene;
	var canvas = application.gl.canvas;
	canvas.tabIndex=1;
	var self = this;

	//disable drop down menu on top of canvas
	canvas.oncontextmenu = function(e) { return false;  };

	canvas.addEventListener(&quot;mousedown&quot;, function(ev) { ev.preventDefault(); ev.stopPropagation(); self.processMouseDown(ev); } );
	canvas.addEventListener(&quot;mouseup&quot;, function(ev) { ev.preventDefault(); ev.stopPropagation(); self.processMouseUp(ev); } );
	canvas.addEventListener(&quot;mousemove&quot;, function(ev) { ev.preventDefault(); ev.stopPropagation(); self.processMouseMove(ev); } );

	canvas.addEventListener(&quot;touchstart&quot;, function(ev) { ev.preventDefault(); ev.stopPropagation(); self.processTouchStart(ev); });
	canvas.addEventListener(&quot;touchend&quot;, function(ev) { ev.preventDefault(); ev.stopPropagation(); self.processTouchEnd(ev); });
	canvas.addEventListener(&quot;touchmove&quot;, function(ev) { ev.preventDefault(); ev.stopPropagation(); self.processTouchMove(ev); });

	document.onkeypress=function(ev) { 
		// propagation enabled so that GUI can handle keys
		// ev.preventDefault(); ev.stopPropagation(); 
		self.processKeyboard(ev); 
	};

	document.onkeydown = function(ev) {
		self.processKeyDown(ev);
	};

	document.onkeyup = function(ev) {
		self.processKeyUp(ev);
	};

	return true;
};

<span id='CGFinterface-method-update'>/**
</span> * @method update
 * @template
 */
CGFinterface.prototype.update = function() {};

<span id='CGFinterface-method-processKeyboard'>/**
</span> * @method processKeyboard
 * Event handler called when the user types a key (presses and releases)
 * @param {Event} event The data for the event, including which key was pressed (see http://javascript.info/tutorial/keyboard-events for details).
 * @template
 */
CGFinterface.prototype.processKeyboard = function(event) {
	console.log('keypress');
};

<span id='CGFinterface-method-processKeyDown'>/**
</span> * @method processKeyDown
 * Event handler called when the user presses down a key
 * @param {Event} event The data for the event, including which key was pressed (see http://javascript.info/tutorial/keyboard-events for details).
  * @template
 */
CGFinterface.prototype.processKeyDown = function(event) {
	console.log('keydown');
};

<span id='CGFinterface-method-processKeyUp'>/**
</span> * @method processKeyUp
 * Event handler called when the user releases a key
 * @param {Event} event The data for the event, including which key was released (see http://javascript.info/tutorial/keyboard-events for details).
 * @template
 */
CGFinterface.prototype.processKeyUp = function(event) {
	console.log('keyup');
};

<span id='CGFinterface-method-setActiveCamera'>/**
</span> * @method setActiveCamera
 * Sets the camera that is active, so that mouse event handlers can modify that camera
 * @param {CGFcamera} camera
 */
CGFinterface.prototype.setActiveCamera = function(camera) {
	this.activeCamera = camera;
};

<span id='CGFinterface-method-processMouseDown'>/**
</span> * @method processMouseDown
 * Event handler called when one of the mouse buttons is pressed
 * @param {Event} event The data associated with the event, including which mouse button was pressed, and the mouse coordinates 
 * @template
 */
CGFinterface.prototype.processMouseDown = function(event) {
	var button = event.which; // 1 - left, 2 - middle, 3 - right
	this.mouseButtons[button - 1] = true;

	this.mouse[0] = event.pageX;
	this.mouse[1] = event.pageY;

	this.prevMouse[0] = this.mouse[0];
	this.prevMouse[1] = this.mouse[1];

	this.ctrlKey = event.ctrlKey;
};

<span id='CGFinterface-method-processMouseUp'>/**
</span> * @method processMouseUp
 * Event handler called when one of the mouse buttons is released
 * @param {Event} event The data associated with the event, including which mouse button was released, and the mouse coordinates 
 * @template
 */

CGFinterface.prototype.processMouseUp = function(event) {
	var button = event.which; // 1 - left, 2 - middle, 3 - right
	this.mouseButtons[button - 1] = false;

	this.prevMouse[0] = this.mouse[0];
	this.prevMouse[1] = this.mouse[1];
	this.mouse[0] = event.pageX;
	this.mouse[1] = event.pageY;

	this.ctrlKey = event.ctrlKey;
};

<span id='CGFinterface-method-processMouseMove'>/**
</span> * @method processMouseMove
 * Event handler called when the mouse moves
 * @param {Event} event The data associated with the event, including the mouse coordinates 
 * @template
 */
CGFinterface.prototype.processMouseMove = function(event) {
	this.prevMouse[0] = this.mouse[0];
	this.prevMouse[1] = this.mouse[1];
	this.mouse[0] = event.pageX;
	this.mouse[1] = event.pageY;

	this.processMouse();
};

<span id='CGFinterface-method-processMouse'>/**
</span> * @method processMouse
 * Processes mouse input. By default is used to control the camera.
 */
CGFinterface.prototype.processMouse = function() {
	if (this.activeCamera) {
		var displacement = vec2.subtract(vec2.create(), this.mouse, this.prevMouse);

		if (this.mouseButtons[0]) { // pressing Left
			if( this.ctrlKey) { // same as pressing middle
				this.activeCamera.zoom(displacement[1] * 0.05);
			}
			else {
				this.activeCamera.orbit(CGFcameraAxisID.X, displacement[1] * Math.PI / 180.0);
				this.activeCamera.orbit(CGFcameraAxisID.Y, -displacement[0] * Math.PI / 180.0);
			}
		} else if (this.mouseButtons[2]) { // pressing Right
			this.activeCamera.pan([-displacement[0] * 0.05, displacement[1] * 0.05, 0]);
		} else if (this.mouseButtons[1] ) { // pressing middle
			this.activeCamera.zoom(displacement[1] * 0.05);
		}
	}
};

<span id='CGFinterface-method-processTouchStart'>/**
</span> * @method processTouchStart
 * Event handler called when a touch point is created
 * @param {Event} event The data associated with the event, including the list of active touches 
 * @template
 */
CGFinterface.prototype.processTouchStart = function(event) {
	this.touches = event.targetTouches;
	this.prevTouches = this.touches;
}

<span id='CGFinterface-method-processTouchEnd'>/**
</span> * @method processTouchEnd
 * Event handler called when a touch point disappears
 * @param {Event} event The data associated with the event, including the list of active touches 
 * @template
 */
CGFinterface.prototype.processTouchEnd = function(event) {
	this.prevTouches = this.touches;
	this.touches = event.targetTouches;
};

<span id='CGFinterface-method-processTouchMove'>/**
</span> * @method processTouchMove
 * Event handler called when a touch point moves
 * @param {Event} event The data associated with the event, including the list of active touches
 * @template
 */
CGFinterface.prototype.processTouchMove = function(event) {
	this.prevTouches = this.touches;
	this.touches = event.targetTouches;

	this.processTouches();
};

<span id='CGFinterface-method-processTouches'>/**
</span> * @method processTouches
 * Function that actually processes touch events (called by processTouchMove)
 * @template
 */
CGFinterface.prototype.processTouches = function() {
	if (this.activeCamera) {
		// if exactly one touch is detected
		if (this.touches.length == 1) {
			var prevTouch = [this.prevTouches[0].pageX, this.prevTouches[0].pageY];
			var touch = [this.touches[0].pageX, this.touches[0].pageY];

			var displacement = vec2.subtract(vec2.create(), touch, prevTouch);

			this.activeCamera.orbit(CGFcameraAxisID.X, displacement[1] * Math.PI / 180.0);
			this.activeCamera.orbit(CGFcameraAxisID.Y, -displacement[0] * Math.PI / 180.0);
		} else {
			var prevTouch1 = [this.prevTouches[0].pageX, this.prevTouches[0].pageY];
			var touch1 = [this.touches[0].pageX, this.touches[0].pageY];

			// if exactly two touches are detected
			if (this.touches.length == 2) {
				var prevTouch2 = [this.prevTouches[1].pageX, this.prevTouches[1].pageY];
				var touch2 = [this.touches[1].pageX, this.touches[1].pageY];

				var prevTouchesDist = this.distanceBetweenPoints(prevTouch1, prevTouch2);
				var touchesDist = this.distanceBetweenPoints(touch1, touch2);

				var zoom = touchesDist - prevTouchesDist;
				this.activeCamera.zoom(zoom * 0.05);
			}
			// if three or more touches are detected
			else {
				var displacement = vec2.subtract(vec2.create(), touch1, prevTouch1);
				this.activeCamera.pan([-displacement[0] * 0.05, displacement[1] * 0.05, 0]);
			}
		}
	}
};

<span id='global-method-distanceBetweenPoints'>/**
</span> * @method distanceBetweenPoints
 * @ignore
 */
CGFinterface.prototype.distanceBetweenPoints = function(a, b) {
	return Math.sqrt((a[0] - b[0]) * (a[0] - b[0]) + (a[1] - b[1]) * (a[1] - b[1]));
};
</pre>
</body>
</html>
